"use strict";(self.webpackChunkricalelog=self.webpackChunkricalelog||[]).push([[5574],{9364:function(e,n,l){l.r(n),l.d(n,{Head:function(){return v},default:function(){return b}});var t=l(1151),a=l(7294);function c(e){const n=Object.assign({p:"p",a:"a",code:"code",h2:"h2",h3:"h3",em:"em",ol:"ol",li:"li",pre:"pre",blockquote:"blockquote",ul:"ul",strong:"strong"},(0,t.ah)(),e.components);return a.createElement(a.Fragment,null,a.createElement(n.p,null,a.createElement(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript"},"자바스크립트는 싱글 스레드다"),". 하지만 우리는 ",a.createElement(n.code,null,"setTimeout()"),", ",a.createElement(n.code,null,"Promise")," 등을 통해 멀티 스레드와 유사한 경험을 한다. 이것이 어떻게 가능한 것일까?"),"\n",a.createElement(n.h2,null,"1. 콜스택, 이벤트루프, 메시지큐"),"\n",a.createElement(n.p,null,"궁금증을 해결하기에 앞서 일단 자바스크립트의 가장 기본적인 실행 단위인 함수 실행 방식에 대해 알아보자."),"\n",a.createElement(n.h3,null,"1.1. 콜스택"),"\n",a.createElement(n.p,null,"콜스택",a.createElement(n.em,null,"CallStack"),"은 현재 실행 중인 함수들을 관리하는 스택이다. 간단히 설명하면 아래와 같다."),"\n",a.createElement(n.ol,null,"\n",a.createElement(n.li,null,"자바스크립트는 함수가 호출되면 콜스택에 해당 함수를 추가",a.createElement(n.em,null,"push"),"한 뒤, 함수의 내용을 실행한다."),"\n",a.createElement(n.li,null,"해당 함수를 실행하던 중 다른 함수를 호출하면 마찬가지로 그 함수도 스택에 추가",a.createElement(n.em,null,"push"),"한다. 자바스크립트는 콜스택의 가장 위에 있는 함수를 실행한다."),"\n",a.createElement(n.li,null,"함수의 실행이 끝나면 해당 함수를 콜스택으로부터 제거",a.createElement(n.em,null,"pop"),"한다. 콜스택에 아직 함수가 남아있다면, 스택의 가장 위에 있는 함수를 계속 실행한다."),"\n",a.createElement(n.li,null,"콜스택이 빌 때까지 2,3번을 반복한다."),"\n"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},'function c() {\n  console.log("call c");\n}\nfunction b() {\n  console.log("call b");\n}\nfunction a() {\n  console.log("call a");\n  b();\n  c();\n}\na();\n')),"\n",a.createElement(n.p,null,"위 코드로 예를 들어 설명하면 아래와 같다."),"\n",a.createElement(n.ol,null,"\n",a.createElement(n.li,null,a.createElement(n.code,null,"a()")," 가 실행되었다. 콜스택에 ",a.createElement(n.code,null,"a()")," 가 추가된다.\n콜스택: ",a.createElement(n.code,null,"[a()]")),"\n",a.createElement(n.li,null,a.createElement(n.code,null,"b()")," 가 실행되었다. 콜스캑에 ",a.createElement(n.code,null,"b()")," 도 추가된다.\n콜스택: ",a.createElement(n.code,null,"[a(), b()]")),"\n",a.createElement(n.li,null,a.createElement(n.code,null,"b()")," 의 실행이 끝난다. 콜스택에서 ",a.createElement(n.code,null,"b()")," 를 제거한다.\n콜스택: ",a.createElement(n.code,null,"[a()]")),"\n",a.createElement(n.li,null,a.createElement(n.code,null,"c()")," 가 실행되었다. 콜스택에 ",a.createElement(n.code,null,"c()")," 도 추가된다.\n콜스택: ",a.createElement(n.code,null,"[a(), c()]")),"\n",a.createElement(n.li,null,"함수 ",a.createElement(n.code,null,"c()")," 의 실행이 끝난다. 콜스택에서 ",a.createElement(n.code,null,"c()")," 를 제거한다.\n콜스택: ",a.createElement(n.code,null,"[a()]")),"\n",a.createElement(n.li,null,"함수 ",a.createElement(n.code,null,"a()")," 의 실행이 끝난다. 콜스택에서 ",a.createElement(n.code,null,"a()")," 를 제거한다.\n콜스택: ",a.createElement(n.code,null,"[]")),"\n"),"\n",a.createElement(n.h3,null,"1.2. 메시지큐, 이벤트루프"),"\n",a.createElement(n.p,null,"코드에 의해 직접 실행된 함수들은 위처럼 실행된다. 하지만 자바스크립트는 코드 상에서 직접 호출하는 함수 이외에도 호출되는 함수들이 있다. 바로 ",a.createElement(n.code,null,"setTimeout")," 이나 DOM 이벤트에 의해 실행되는 콜백 함수들이다. 이 콜백 함수들은 해당 이벤트가 발생할 때마다 메시지큐",a.createElement(n.em,null,"MessageQueue"),"라는 큐에 추가된다."),"\n",a.createElement(n.p,null,"한편 자바스크립트에는 이벤트루프",a.createElement(n.em,null,"EventLoop"),"라는 것이 존재하는데, 이벤트루프는 콜스택과 메시지큐를 계속 확인한다. 콜스택이 비어있으면서 메시지큐에 함수가 있다면, 해당 함수를 메시지큐로부터 콜스택으로 옮겨넣는다."),"\n",a.createElement(n.h2,null,"2. 자바스크립트는 싱글스레드라며?"),"\n",a.createElement(n.p,null,"그런데 여기서 의문점이 생긴다."),"\n",a.createElement(n.blockquote,null,"\n",a.createElement(n.p,null,'"자바스크립트는 싱글 스레드라서 한 번에 한 가지 일밖에 처리를 못하는데, 어떻게 1. 콜스택에서 함수가 실행되고 있는 와중에 2. 메시지큐에 콜백 함수를 추가할 수 있는 거지? 이게 가능하려면 메시지큐에 콜백 함수를 추가하는 코드는 별도의 스레드에서 돌고 있어야 하는 거 아닌가? 그럼 자바스크립트는 멀티 스레드여야 하는데?"'),"\n"),"\n",a.createElement(n.p,null,"이 의문은 반은 맞고 반은 틀렸다."),"\n",a.createElement(n.p,null,"자바스크립트는 싱글 스레드가 맞다. 하지만 ",a.createElement(n.em,null,"자바스크립트가 실행되는 런타임 환경은 싱글 스레드가 아니다."),' 멀티 스레드이다. 여기서 말하는 *"자바스크립트가 실행되는 런타임 환경"*은 Node.js, 웹브라우저 등이 있다.'),"\n",a.createElement(n.p,null,'프론트엔드 엔지니어 관점에서 웹브라우저에만 집중하자면, 웹브라우저는 "자바스크립트 실행 컨텍스트"라는 스레드 이외에 브라우저의 스레드가 별도로 존재한다. 해당 스레드에서는 ',a.createElement(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API"},"Web API")," 가 실행되는데, Web API 의 대표적인 기능은 아래와 같다."),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,"DOM"),"\n",a.createElement(n.li,null,"ajax"),"\n",a.createElement(n.li,null,"setTimeout 등 타이머 처리"),"\n"),"\n",a.createElement(n.p,null,"브라우저 스레드는 Web API 에 의해 발생하는 이벤트의 콜백 함수들을 메시지큐에 밀어넣는다."),"\n",a.createElement(n.p,null,"(브라우저 환경은 이외에도 웹워커",a.createElement(n.em,null,"WebWorker"),"라는 별도의 스레드가 존재하며, 런타임 환경에 따라서 더 많은 스레드가 존재할 수 있다.)"),"\n",a.createElement(n.h2,null,"3. ",a.createElement(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all"},a.createElement(n.code,null,"Promise.all()"))),"\n",a.createElement(n.p,null,"좋다. 자바스크립트는 싱글 스레드지만 자바스크립트 런타임 환경은 멀티 스레드라는 것을 알았다. Web API 실행을 위한 스레드가 하나 더 존재하며, 따라서 ",a.createElement(n.code,null,"setTimeout")," 이나 DOM 이벤트, Promise 의 콜백들이 문제 없이 실행된다는 것을 알았다."),"\n",a.createElement(n.p,null,"그렇다면 여기서 한 가지 의문이 든다."),"\n",a.createElement(n.blockquote,null,"\n",a.createElement(n.p,null,'"',a.createElement(n.code,null,"Promise.all()"),'은? 이 함수는 여러 Promise 들을 동시에 실행시켜주는 거 아니었어? 그런데 브라우저 스레드가 싱글 스레드면 말이 안 되잖아? 멀티 스레드인 거 아냐?"'),"\n"),"\n",a.createElement(n.p,null,"아래 코드를 보자."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},'function func1() {\n  console.log("func1 called");\n  return new Promise((resolve) => {\n    for (let i = 0; i < 50000; i++) {\n      if (i % 10000 === 0) {\n        console.log("func1", i);\n      }\n    }\n    resolve();\n    console.log("func1 end");\n  });\n}\nfunction func2() {\n  console.log("func2 called");\n  return new Promise((resolve) => {\n    for (let i = 0; i < 50000; i++) {\n      if (i % 10000 === 0) {\n        console.log("func2", i);\n      }\n    }\n    resolve();\n    console.log("func2 end");\n  });\n}\nPromise.all([func1(), func2()]);\n\n// 실행 결과\n// func1 called\n// func1 0\n// func1 10000\n// func1 20000\n// func1 30000\n// func1 40000\n// func1 end\n// func2 called\n// func2 0\n// func2 10000\n// func2 20000\n// func2 30000\n// func2 40000\n// func2 end\n')),"\n",a.createElement(n.p,null,"멀티 스레드에서 실행되지 않는 것을 알 수 있다. ",a.createElement(n.code,null,"Promise.all")," 도 기존 Promise 와 동일한 방법으로 실행된다. 인자로 받은 함수들은 동기적으로 차례로 실행되며, 실행이 완료되었을 때 콜백을 메시지큐에 넣는다."),"\n",a.createElement(n.h2,null,"4. 결론"),"\n",a.createElement(n.p,null,"따라서 우리가 얻은 결론은 아주 간단하다."),"\n",a.createElement(n.p,null,a.createElement(n.strong,null,"자바스크립트는 싱글 스레드다. 하지만 자바스크립트의 런타임 환경은 멀티 스레드다.")),"\n",a.createElement(n.h2,null,"5. 더 알아봐야 할 것들.."),"\n",a.createElement(n.p,null,"명쾌하게 해결된 궁금증도 있지만 아직도 모호하거나 오히려 새로 생긴 궁금증들이 있다. 잘 기록해두었다가 나중에 다시 조사해보자."),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,"자바스크립트가 싱글 스레드라면, 그리고 메시지큐가 자바스크립트의 스레드에 포함된 녀석이라면, 어떻게 콜스택이 실행되고 있는 와중에 메시지큐는 메시지(함수)를 받을 수 있는 것일까?","\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,"(10월 10일 덧붙임): 자바스크립트는 스크립트가 실행되는 단일 스레드로만 이루어진 게 맞다. 이벤트루프와 메시지큐는 이 스레드에 속하지 않은, 별도의 스레드에서 실행되는 녀석들이다 (브라우저, nodejs 등이 지원). 따라서 자바스크립트가 싱글 스레드에서 실행되는 동안, 이벤트루프와 메시지큐는 개별적으로 실행될 수 있다. ",a.createElement(n.a,{href:"https://stackoverflow.com/questions/73934092/can-javascript-message-queues-be-blocked"},"참고")),"\n"),"\n"),"\n",a.createElement(n.li,null,a.createElement(n.a,{href:"https://www.slideshare.net/koreakihoon/javascript-single-thread"},"어떤 글"),"에서는 Promise 가 Web API 스레드에서 실행된다고 하고, ",a.createElement(n.a,{href:"https://dev.to/moyedx3/9-message-queue-and-event-loop-5092"},"어떤 글"),"에서는 자바스크립트 스레드에서 실행된다고 한다. 뭐가 맞는 것인가?","\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,"자바스크립트 스레드일 가능성이 높아 보인다."),"\n",a.createElement(n.li,null,"이건 마이크로태스크큐",a.createElement(n.em,null,"MicrotaskQueue"),"와 같이 정리하면 될 것 같다."),"\n",a.createElement(n.li,null,"(10월 10일 덧붙임): Promise 는 자바스크립트 스레드에서 실행되는 게 맞다."),"\n"),"\n"),"\n",a.createElement(n.li,null,"ajax 콜은 여러 콜이 동시에 비동기적으로 실행된다는데, 이게 사실인가? 사실이라면 원리는 무엇인가?","\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,'"겉보기에는 비동기적이지만 내부적으로는 동기적으로 실행된다."가 아니라 ',a.createElement(n.a,{href:"https://stackoverflow.com/questions/22844441/is-promise-all-useful-given-that-javascript-is-executed-in-a-single-thread"},"실제로 비동기적으로 실행된다고 하는 글"),"이 있는데, 확인이 필요하다."),"\n",a.createElement(n.li,null,"(10월 10일 덧붙임): ajax 콜은 브라우저에 의해 멀티 스레드에서 실행된다."),"\n"),"\n"),"\n"),"\n",a.createElement(n.h2,null,"6. References"),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,a.createElement(n.a,{href:"https://www.slideshare.net/koreakihoon/javascript-single-thread"},"javascript 는 single thread 일까?")),"\n",a.createElement(n.li,null,a.createElement(n.a,{href:"https://ingg.dev/js-work/"},"[JS] Javascript 동작 원리와 비동기처리")),"\n",a.createElement(n.li,null,a.createElement(n.a,{href:"https://intrepidgeeks.com/tutorial/event-loop-web-api-task-queue"},"Event Loop, Web API, Task Queue")),"\n",a.createElement(n.li,null,a.createElement(n.a,{href:"https://velog.io/@thms200/Event-Loop-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84"},"Event Loop (이벤트 루프)")),"\n",a.createElement(n.li,null,a.createElement(n.a,{href:"https://javascript.plainenglish.io/does-promise-all-execute-in-parallel-how-promise-all-works-in-javascript-fffc2e8d455d"},"Does Promise.all Execute in Parallel? How Promise.all Works in JavaScript")),"\n",a.createElement(n.li,null,a.createElement(n.a,{href:"https://developer.mozilla.org/en-US/docs/Glossary/Call_stack"},"MDN Web docs - Call stack")),"\n"))}var r,o=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,t.ah)(),e.components);return n?a.createElement(n,e,a.createElement(c,e)):c(e)},u=l(1880),m=l(1883),i=l(3723),s=l(1858),E=l(3904),p=l(891),d=l(5534),h=l(5777);const f=e=>{let{data:n,children:l}=e;const{title:t,date:c,tags:r,heroImage:o,heroImageAlt:u}=n.mdx.frontmatter,E=o?(0,i.c)(o):null;return a.createElement(s.Z,null,a.createElement("h1",null,t),a.createElement(g,null,r.map((e=>a.createElement("li",{key:e},a.createElement(m.rU,{to:"/tags/"+e},e))))),a.createElement("div",null,c),!!E&&a.createElement(i.G,{image:E,alt:null!=u?u:""}),a.createElement(d.Z,null,l),a.createElement(h.Z,null))},g=p.ZP.ul(r||(r=(0,u.Z)(["\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  gap: ","px;\n\n  margin: 0;\n  padding: 0;\n  list-style: none;\n\n  > li {\n    padding: ","px ","px\n      0px;\n    border-radius: 2px;\n\n    background-color: ",";\n    color: ",";\n\n    > a {\n      text-decoration: none;\n    }\n  }\n"])),(e=>e.theme.dimens.gutter),(e=>e.theme.dimens.thin),(e=>e.theme.dimens.gutter),(e=>e.theme.colors.tag),(e=>e.theme.colors.onTag)),v=e=>{var n,l;let{data:t}=e;const{frontmatter:{title:c,slug:r,tags:o,heroImage:u},excerpt:m}=t.mdx,s=u?(0,i.c)(u):null;return a.createElement(E.Z,{title:c,description:m,path:"posts/"+r,thumbnail:null==s||null===(n=s.images)||void 0===n||null===(l=n.fallback)||void 0===l?void 0:l.src,keywords:o,ogType:"article"})};function b(e){return a.createElement(f,e,a.createElement(o,e))}}}]);
//# sourceMappingURL=component---src-pages-posts-mdx-frontmatter-slug-tsx-content-file-path-users-kangseong-workspace-private-ricalelog-posts-2022-220926-is-javascript-single-threaded-index-mdx-99a7ecf1ca6c3163a092.js.map