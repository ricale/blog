"use strict";(self.webpackChunkricalelog=self.webpackChunkricalelog||[]).push([[5600],{8462:function(e,n,t){t.r(n),t.d(n,{Head:function(){return A},default:function(){return f}});var l=t(1151),a=t(7294);function c(e){const n=Object.assign({h2:"h2",p:"p",a:"a",div:"div",strong:"strong",em:"em",code:"code",ol:"ol",li:"li",h3:"h3",pre:"pre",ul:"ul",h4:"h4"},(0,l.ah)(),e.components);return a.createElement(a.Fragment,null,a.createElement(n.h2,null,"1. 발단"),"\n",a.createElement(n.p,null,"회사의 React 기반 웹앱 프로젝트에서, iOS 스타일의 Date Picker UI 를 사용해야 하는 일이 생겼다. 직접 구현하기에는 기능에 비해 주어진 시간이 많지 않았으므로 오픈소스 라이브러리를 찾아 설치하려고 했다. 그런데 의외로 원하는 스타일의 Date Picker 를 찾기 어려웠다. iOS 스타일의 스크롤되는 형식보다는 안드로이드 스타일의 달력 형식이 주류였다."),"\n",a.createElement(n.p,null,"어찌저찌 찾기는 찾았다. 다만 라이브러리는 아니고 ",a.createElement(n.a,{href:"https://gist.github.com/wjpeters/876a8fe4040a2bb4b4eb28d2270620a5"},"Gist 에 올라와있는"),", 순수 자바스크립트로 작성된 코드 조각이었다. (아래 이미지는 CodePen 에 올라와있는 해당 코드 조각 ",a.createElement(n.a,{href:"https://codepen.io/gnauhca/pen/JrdpZZ"},"실행 예제"),"다.)"),"\n",a.createElement(n.div,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/blog/static/0df1dd1ab3ffe2bc5c337bf023278699/9c1e6/1.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAdElEQVR42sWQSwrAIAxE4wcVP4huvP9JUxQqNgq1UHAhYQZ9ZgYAAH8+s6mUQinlw6Oac45CiEPAlBI657pmjGEIoc3xU2vtO7A+KqVgjLHruk3Ouc0baoxB7/3ehlrrKSKNV+H0zifgqsNt4BhtrGJVD/UuFFuiB2xulAMAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="1"\n        title=""\n        src="/blog/static/0df1dd1ab3ffe2bc5c337bf023278699/5a190/1.png"\n        srcset="/blog/static/0df1dd1ab3ffe2bc5c337bf023278699/772e8/1.png 200w,\n/blog/static/0df1dd1ab3ffe2bc5c337bf023278699/e17e5/1.png 400w,\n/blog/static/0df1dd1ab3ffe2bc5c337bf023278699/5a190/1.png 800w,\n/blog/static/0df1dd1ab3ffe2bc5c337bf023278699/c1b63/1.png 1200w,\n/blog/static/0df1dd1ab3ffe2bc5c337bf023278699/29007/1.png 1600w,\n/blog/static/0df1dd1ab3ffe2bc5c337bf023278699/9c1e6/1.png 1734w"\n        sizes="(max-width: 800px) 100vw, 800px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",a.createElement(n.p,null,"일단 확인해 본 예제가 마음에 들었기 때문에, 회사 프로젝트에서는 스타일을 좀 수정하고 React 컴포넌트로 래핑만 해서 사용했다. 잘 적용하고 돌아보니 이 코드를 React 컴포넌트로 만들어서 패키지로 만들고 싶은 욕심이 생겼다. (라이센스를 확인해보니 다행히 자유로운 사용이 가능했다.)"),"\n",a.createElement(n.p,null,"그래서 ",a.createElement(n.strong,null,a.createElement(n.em,null,"iOS 스타일의 Date Picker UI 를 라이브러리로 구현")),"해보기로 하겠다. 물론 그 이전에 기존 코드에 대한 이해를 먼저 해야겠다."),"\n",a.createElement(n.h2,null,"2. 기존 코드 리뷰"),"\n",a.createElement(n.p,null,"기존 코드는 ",a.createElement(n.code,null,"IosSelector")," 라는 클래스를 중심으로 이루어져있다."),"\n",a.createElement(n.div,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/blog/static/b81b487eb7f5d33c6741d04609fb95d3/9c1e6/2.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAt0lEQVR42p2S2RKDIAxFIQmLoLX6oP3/H70NLY7WzpS2D3cCgZwsYIwx2GRVVzJY2eCmynY/+0H7JirAqc3BIzqB17WvZ07kJZCIwMxtYLHiPYgFdAS6P4GkmqYJOWew+kJJYi2GYYBVu931mjSl1AayBi3Liss4PoFkYbWaeZ4fVW3QGCP6vm8Dy8P4EMBSW65jOLdX4HKa6xuw02BRmxQYvniUJtDVKjsmRG01lsDtSx3mZz747qr7oxHfkRNpAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="2"\n        title=""\n        src="/blog/static/b81b487eb7f5d33c6741d04609fb95d3/5a190/2.png"\n        srcset="/blog/static/b81b487eb7f5d33c6741d04609fb95d3/772e8/2.png 200w,\n/blog/static/b81b487eb7f5d33c6741d04609fb95d3/e17e5/2.png 400w,\n/blog/static/b81b487eb7f5d33c6741d04609fb95d3/5a190/2.png 800w,\n/blog/static/b81b487eb7f5d33c6741d04609fb95d3/c1b63/2.png 1200w,\n/blog/static/b81b487eb7f5d33c6741d04609fb95d3/29007/2.png 1600w,\n/blog/static/b81b487eb7f5d33c6741d04609fb95d3/9c1e6/2.png 1734w"\n        sizes="(max-width: 800px) 100vw, 800px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",a.createElement(n.p,null,"해당 클래스만 450라인이 조금 넘는 정도고, 초기화를 돕는 나머지 유틸 함수들이 100라인 미만으로 존재한다."),"\n",a.createElement(n.p,null,"(아래 이미지는 ",a.createElement(n.code,null,"IosSelector")," 클래스 내부 메서드들의 콜 다이어그램이다.)"),"\n",a.createElement(n.div,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 761px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/blog/static/6f7ac17e071d3e70ca6969244d6e7448/8c857/3.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 96%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVR42p2UiY7CMAxE8//fWFGuAuUohXKVHkbPklfesGy7a8lK0zjjydhJuN1ucj6fpaoq9dPpJPzbbrdyvV6lrmvB+r5XH7LA5vv9riBFUegIEP54PKRpGum67gtsCDRYZpzNh8NBQWezmSRJIsvlUhN6pr8C+gnBHBsJ1uu17HY72Ww2KsPz+fw7QwwwjgvgfD6XPM//zxBjM4CLxUKyLFO/XC7jGSI8wYwmvn2bM2/bdhwgbNDqeDx+a5vJZKJFmU6nOh99ZIJjR0daiIqTiKR0gAf0o/fgK4yVZakA+/1ejxo3duxvDNGGBRthAhDFscYeMvaiNWNAN9hwRKoJIwM00E9OLJKgOxjsD0xwjkqQZYxvkHVA7PSpXQakCqAywY0V/9I01UozEmh96A2GrPk6KCAvi1G3Cq9WK/3PyJoBeqYwi6sf4koRxNFJRALmpiVsAEcekrIWt0+I3zp7uowdGhk47LkEFIB109zvD37y6c3zR/RF/On2vDH8dAMwmMIO1tyiOBZ7AYLuzoSLVuSJAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="3"\n        title=""\n        src="/blog/static/6f7ac17e071d3e70ca6969244d6e7448/8c857/3.png"\n        srcset="/blog/static/6f7ac17e071d3e70ca6969244d6e7448/772e8/3.png 200w,\n/blog/static/6f7ac17e071d3e70ca6969244d6e7448/e17e5/3.png 400w,\n/blog/static/6f7ac17e071d3e70ca6969244d6e7448/8c857/3.png 761w"\n        sizes="(max-width: 761px) 100vw, 761px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",a.createElement(n.p,null,"클래스 내에서 눈여겨볼만한 로직은 아래 세 가지 정도가 있다."),"\n",a.createElement(n.ol,null,"\n",a.createElement(n.li,null,"엘리먼트 생성 및 이벤트 처리"),"\n",a.createElement(n.li,null,"터치 이벤트 처리"),"\n",a.createElement(n.li,null,"월별 일수가 다른 것 처리"),"\n"),"\n",a.createElement(n.p,null,"하나씩 천천히 살펴보자."),"\n",a.createElement(n.h3,null,"2.1. 엘리먼트 생성 및 이벤트 처리"),"\n",a.createElement(n.p,null,"엘리먼트는 DOM 에 직접 접근해서 ",a.createElement(n.code,null,"innerHTML")," 을 사용해 생성한다."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},'this.elems.el.innerHTML = template\n  .replace("{{circleListHTML}}", circleListHTML)\n  .replace("{{highListHTML}}", highListHTML);\n')),"\n",a.createElement(n.p,null,"여기서 ",a.createElement(n.code,null,"template")," 은 그냥 엘리먼트를 문자열로 하드코딩한 값이다."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},'let template = `\n  <div class="select-wrap">\n    <ul class="select-options" style="transform: translate3d(0, 0, ${-this\n      .radius}px) rotateX(0deg);">\n      {{circleListHTML}}\n    </ul>\n    <div class="highlight">\n      <ul class="highlight-list">\n        {{highListHTML}}\n      </ul>\n    </div>\n  </div>\n`;\n')),"\n",a.createElement(n.p,null,a.createElement(n.code,null,"circleListHTML"),"은 사용자가 스크롤하면 돌아갈 아이템들이다. 여기서 스크롤은 실제로 엘리먼트들이 스크롤되는 것이 아니라 ",a.createElement(n.code,null,"transfrom: rotateX translate3d()"),"를 활용한 애니메이션이다."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},'for (let i = 0; i < source.length; i++) {\n  circleListHTML += `<li class="select-option"\n    style="\n      top: ${this.itemHeight * -0.5}px;\n      height: ${this.itemHeight}px;\n      line-height: ${this.itemHeight}px;\n      transform: rotateX(${-this.itemAngle * i}deg) translate3d(0, 0, ${\n    this.radius\n  }px);\n    "\n    data-index="${i}"\n    >${source[i].text}</li>`;\n}\n')),"\n",a.createElement(n.p,null,"이 ",a.createElement(n.code,null,"transform")," 은 추후에 애니메이션이 필요할 때마다 아래처럼 값이 변경된다."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"this.elems.circleList.style.transform =\n  `translate3d(0, 0, ${-this.radius}px) ` +\n  `rotateX(${this.itemAngle * scroll}deg)`;\n")),"\n",a.createElement(n.p,null,a.createElement(n.code,null,"highListHTML"),"은 ",a.createElement(n.code,null,"circleListHTML"),"과 거의 동일하다. 다만 선택된 값을 표시하는 부분만 보이도록 처리되어, 선택된 값을 강조하는 용도로 사용된다."),"\n",a.createElement(n.h3,null,"2.2. 터치 이벤트 처리"),"\n",a.createElement(n.p,null,"평소에는 ",a.createElement(n.code,null,"touchstart"),"와 ",a.createElement(n.code,null,"touchend")," 이벤트 리스너만 설정되어 있다."),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,a.createElement(n.code,null,"touchstart")," 이벤트가 발생하면 ",a.createElement(n.code,null,"touchmove")," 리스너를 붙였다가,","\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},'this.elems.el.addEventListener("touchmove", this.events.touchmove);\n')),"\n"),"\n",a.createElement(n.li,null,a.createElement(n.code,null,"touchend")," 이벤트 발생 시 ",a.createElement(n.code,null,"touchmove")," 리스너를 떼어낸다.","\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},'this.elems.el.removeEventListener("touchmove", this.events.touchmove);\n')),"\n"),"\n"),"\n",a.createElement(n.h4,null,a.createElement(n.code,null,"touchstart")),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,'"이벤트 시작 지점 좌표"를 저장해둔다.'),"\n",a.createElement(n.li,null,"혹시 애니메이션 중이었다면 중지시킨다."),"\n"),"\n",a.createElement(n.h4,null,a.createElement(n.code,null,"touchmove")),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,a.createElement(n.code,null,"touchstart"),' 시점에 저장해놓은 "이벤트 시작 지점 좌표"와 "현재 이벤트 발생 지점 좌표"를 비교해 적절한 아이템까지 엘리먼트를 스크롤 시킨다.'),"\n",a.createElement(n.li,null,"그리고 ",a.createElement(n.code,null,"touchend")," 에서 사용하기 위해, 이벤트 발생 시점 타임스탬프와 좌표를 따로 저장해둔다. (최대 다섯 개)","\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"let eventY = e.clientY || e.touches[0].clientY;\ntouchData.yArr.push([eventY, new Date().getTime()]);\nif (touchData.length > 5) {\n  touchData.unshift();\n}\n")),"\n"),"\n"),"\n",a.createElement(n.h4,null,a.createElement(n.code,null,"touchend")),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,"\n",a.createElement(n.p,null,"마지막 ",a.createElement(n.code,null,"touchmove")," 이벤트 두 건에 대한 정보 (타임스탬프, 좌표)로 반동 스크롤이 어디까지 가야할지 계산한다."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"let startTime = touchData.yArr[touchData.yArr.length - 2][1];\nlet endTime = touchData.yArr[touchData.yArr.length - 1][1];\nlet startY = touchData.yArr[touchData.yArr.length - 2][0];\nlet endY = touchData.yArr[touchData.yArr.length - 1][0];\n\nv = (((startY - endY) / this.itemHeight) * 1000) / (endTime - startTime);\nlet sign = v > 0 ? 1 : -1;\n\nv = Math.abs(v) > 30 ? 30 * sign : v;\n")),"\n"),"\n",a.createElement(n.li,null,"\n",a.createElement(n.p,null,"애니메이션을 한 번에 적용하는 게 아니라 작게 나눠서 ",a.createElement(n.code,null,"requestAnimationFrame")," 을 반복해서 호출하는 방식으로 적용한다."),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,a.createElement(n.code,null,"touchstart")," 이벤트가 치고 들어오면 언제든 ",a.createElement(n.code,null,"cancelAnimationFrame")," 을 써서 중지할 수 있다"),"\n"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"return new Promise((resolve, reject) => {\n  this.moving = true;\n  const tick = () => {\n    pass = new Date().getTime() / 1000 - start;\n\n    if (pass < t) {\n      this.scroll = this._moveTo(\n        initScroll + easing[easingName](pass / t) * totalScrollLen\n      );\n      this.moveT = requestAnimationFrame(tick);\n    } else {\n      resolve();\n      this._stop();\n      this.scroll = this._moveTo(initScroll + totalScrollLen);\n    }\n  };\n  tick();\n});\n")),"\n"),"\n"),"\n",a.createElement(n.h3,null,"2.3. 월별 일수가 다른 것 처리"),"\n",a.createElement(n.p,null,"월을 표시하는 ",a.createElement(n.code,null,"IosSelector")," 의 ",a.createElement(n.code,null,"onChange")," 이벤트가 발생할 때마다 해당 년월에 선택하는한 일 범위를 계산해, 일을 표시하는 ",a.createElement(n.code,null,"IosSelector")," 에게 전달한다."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"onChange: (selected) => {\n  currentMonth = selected.value;\n\n  daySource = getDays(currentYear, currentMonth);\n  // `daySelector`: 일을 표시하는 `IosSelector` 인스턴스\n  daySelector.updateSource(daySource);\n};\n")),"\n",a.createElement(n.h2,null,"3. 다음"),"\n",a.createElement(n.p,null,"이제 다음으로 해야할 일은 아래와 같다."),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,"취향에 맞는 리팩토링"),"\n",a.createElement(n.li,null,"vite 로 빌드 및 배포 환경 구성"),"\n",a.createElement(n.li,null,"storybook 으로 데모 페이지 작성 및 배포"),"\n",a.createElement(n.li,null,"npm 에 패키지 배포"),"\n"),"\n",a.createElement(n.p,null,"이 글에서 모두 이야기하기에는 글이 길어질 것 같으므로, 나눠서 작성하도록 하겠다."))}var r,s=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,l.ah)(),e.components);return n?a.createElement(n,e,a.createElement(c,e)):c(e)},i=t(1880),o=t(1883),m=t(3723),u=t(1858),d=t(3904),g=t(891),p=t(5534),h=t(5777);const b=e=>{let{data:n,children:t}=e;const{title:l,date:c,tags:r,heroImage:s,heroImageAlt:i}=n.mdx.frontmatter,d=s?(0,m.c)(s):null;return a.createElement(u.Z,null,a.createElement("h1",null,l),a.createElement(E,null,r.map((e=>a.createElement("li",{key:e},a.createElement(o.rU,{to:"/tags/"+e},e))))),a.createElement("div",null,c),!!d&&a.createElement(m.G,{image:d,alt:null!=i?i:""}),a.createElement(p.Z,null,t),a.createElement(h.Z,null))},E=g.ZP.ul(r||(r=(0,i.Z)(["\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  gap: ","px;\n\n  margin: 0;\n  padding: 0;\n  list-style: none;\n\n  > li {\n    padding: ","px ","px\n      0px;\n    border-radius: 2px;\n\n    background-color: ",";\n    color: ",";\n\n    > a {\n      text-decoration: none;\n    }\n  }\n"])),(e=>e.theme.dimens.gutter),(e=>e.theme.dimens.thin),(e=>e.theme.dimens.gutter),(e=>e.theme.colors.tag),(e=>e.theme.colors.onTag)),A=e=>{var n,t;let{data:l}=e;const{frontmatter:{title:c,slug:r,tags:s,heroImage:i},excerpt:o}=l.mdx,u=i?(0,m.c)(i):null;return a.createElement(d.Z,{title:c,description:o,path:"posts/"+r,thumbnail:null==u||null===(n=u.images)||void 0===n||null===(t=n.fallback)||void 0===t?void 0:t.src,keywords:s,ogType:"article"})};function f(e){return a.createElement(b,e,a.createElement(s,e))}}}]);
//# sourceMappingURL=component---src-pages-posts-mdx-frontmatter-slug-tsx-content-file-path-users-kangseong-workspace-private-ricalelog-posts-2022-221214-ios-style-picker-1-index-mdx-745b2d74c479b7ac5f00.js.map