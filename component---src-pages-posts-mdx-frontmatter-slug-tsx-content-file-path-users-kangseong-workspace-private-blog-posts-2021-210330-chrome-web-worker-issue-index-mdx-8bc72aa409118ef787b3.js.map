{"version":3,"file":"component---src-pages-posts-mdx-frontmatter-slug-tsx-content-file-path-users-kangseong-workspace-private-blog-posts-2021-210330-chrome-web-worker-issue-index-mdx-8bc72aa409118ef787b3.js","mappings":"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","sources":["webpack://ricalelog/./posts/2021/210330-chrome-web-worker-issue/index.mdx","webpack://ricalelog/./src/pages/posts/{mdx.frontmatter__slug}.tsx"],"sourcesContent":["/*@jsxRuntime classic @jsx React.createElement @jsxFrag React.Fragment*/\nimport {useMDXComponents as _provideComponents} from \"@mdx-js/react\";\nimport React from \"react\";\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    div: \"div\",\n    h2: \"h2\",\n    a: \"a\",\n    p: \"p\",\n    code: \"code\",\n    ol: \"ol\",\n    li: \"li\",\n    ul: \"ul\",\n    h3: \"h3\",\n    button: \"button\"\n  }, _provideComponents(), props.components);\n  return React.createElement(React.Fragment, null, React.createElement(_components.div, {\n    className: \"md\"\n  }, React.createElement(_components.h2, {\n    id: \"1-발단\",\n    style: {\n      position: \"relative\"\n    }\n  }, React.createElement(_components.a, {\n    href: \"#1-%EB%B0%9C%EB%8B%A8\",\n    \"aria-label\": \"1 발단 permalink\",\n    className: \"anchor before\"\n  }, React.createElement(_components.div, {\n    dangerouslySetInnerHTML: {\n      __html: \"<svg aria-hidden=\\\"true\\\" focusable=\\\"false\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg>\"\n    }\n  })), \"1. 발단\"), React.createElement(_components.p, null, \"3월 초 즈음 크롬이 업데이트된 이후로 우리 웹앱에서 이미지 업로드가 되지 않는 현상이 발생했다. 해당 현상은 크롬 사용자에게만 나타났다. 그냥 자바스크립트 에러가 나면서 기능이 동작하지 않는 정도가 아니다. 아래처럼 아예 크롬이 죽어버린다.\"), React.createElement(_components.div, {\n    dangerouslySetInnerHTML: {\n      __html: \"<figure class=\\\"gatsby-resp-image-figure\\\" style=\\\"\\\">\\n    <span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/0a976531181956186e71e289db11bc33/f11bb/screenshot.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAABk0lEQVR42qWS207CQBCG+wIqeqlGYNtt99itrVXREiMeAjGeYjR4THwUe2F8YaOpyphBakCloF582c5M5u8/O2spm/ClSN23Do7Tw6OTdGunmTrUTWdny+ncfCVdKJNCqjZNPWnulA4eyhXCrMgEt0m9Aa29A9g/OoXN3X2IkyZE63WIa3UQOizEhMuwWt+Cjc1tYFzdWI7jXgppQEj9LJXJEOVHmR+EmW/CLM8NQ0g/41w9Ma6A2LRtVQm9Ylyi+hvjqtOFyY7X4zNXhNAvXGioEufcIjYKKuBCv3GhO1hgyEduHLBnuGAuhNeA3zl84Cd+f4w9xYJSGVipJd1TKDMghielLuA19eLRgkL6EMU1CBZjCMK4G+dOhQpgrXEMyiwBY3I8h1iUOvxhZAlSLUKycwraxKMF0X4+1telDIzs0FyseORecehGf72U3OFv+O6Q0MveiK8Dj3t8sCdDjdzhdd8DhT+CCwVC6IVVqdpt1+PgeuLJ9cTzH3l0PQHlCjmzJiYmZ0ql6fWpf1IqTSeo9Q4hFqtPcRps5AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"screenshot\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/0a976531181956186e71e289db11bc33/7491f/screenshot.png\\\"\\n        srcset=\\\"/blog/static/0a976531181956186e71e289db11bc33/b8d62/screenshot.png 150w,\\n/blog/static/0a976531181956186e71e289db11bc33/eed55/screenshot.png 300w,\\n/blog/static/0a976531181956186e71e289db11bc33/7491f/screenshot.png 600w,\\n/blog/static/0a976531181956186e71e289db11bc33/385f2/screenshot.png 900w,\\n/blog/static/0a976531181956186e71e289db11bc33/8537d/screenshot.png 1200w,\\n/blog/static/0a976531181956186e71e289db11bc33/f11bb/screenshot.png 2954w\\\"\\n        sizes=\\\"(max-width: 600px) 100vw, 600px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\\n    <figcaption class=\\\"gatsby-resp-image-figcaption\\\">screenshot</figcaption>\\n  </figure>\"\n    }\n  }), React.createElement(_components.p, null, \"크롬이 죽는 순간 개발자도구도 같이 죽기 때문에, 이 현상의 유일한 단서는 화면에 표시된 \", React.createElement(_components.code, null, \"RESULT_CODE_KILLED_BAD_MESSAGE\"), \" 뿐이었다. 하지만 해당 메시지를 포함한 여러 가지 조합으로 검색을 시도해봤지만 유의미한 정보를 찾을 수는 없었다.\"), React.createElement(_components.p, null, \"불행 중 다행인 것은 파이어폭스로는 해당 기능이 문제없이 동작한다는 것이었다. 일단 고객 측에는 임시로 파이어폭스를 사용해달라고 하고, 원인을 찾기로 했다.\"), React.createElement(_components.h2, {\n    id: \"2-현황-및-원인\",\n    style: {\n      position: \"relative\"\n    }\n  }, React.createElement(_components.a, {\n    href: \"#2-%ED%98%84%ED%99%A9-%EB%B0%8F-%EC%9B%90%EC%9D%B8\",\n    \"aria-label\": \"2 현황 및 원인 permalink\",\n    className: \"anchor before\"\n  }, React.createElement(_components.div, {\n    dangerouslySetInnerHTML: {\n      __html: \"<svg aria-hidden=\\\"true\\\" focusable=\\\"false\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg>\"\n    }\n  })), \"2. 현황 및 원인\"), React.createElement(_components.p, null, \"현재 우리의 이미지 업로드 기능은 아래와 같이 구현되어 있다.\"), React.createElement(_components.ol, null, \"\\n\", React.createElement(_components.li, null, \"사용자가 이미지 업로드를 시도하면 이미지 업로드 Redux Action 이 발송(\", React.createElement(_components.code, null, \"dispatch\"), \") 된다.\"), \"\\n\", React.createElement(_components.li, null, \"해당 액션을 듣고 있던 Redux Saga 가 Web Worker 에 이미지 업로드를 요청(\", React.createElement(_components.code, null, \"worker.postMessage\"), \")한다.\", \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"이미지는 여러 개일 수 있고 고용량일 수도 있기 때문에 메인 스레드에서는 직접 업로드하지 않고 워커 스레드를 사용한다.\"), \"\\n\"), \"\\n\"), \"\\n\", React.createElement(_components.li, null, \"Web Worker 는 \", React.createElement(_components.code, null, \"fetch\"), \" 메서드를 사용해 이미지 업로드 리퀘스트를 발송한다.\", \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"이미지가 여러 개일 경우 리퀘스트는 이미지 개수만큼 발송된다.\"), \"\\n\"), \"\\n\"), \"\\n\", React.createElement(_components.li, null, \"이미지 업로드가 성공/실패할 때마다 메인 스레드에 결과를 알린다 (\", React.createElement(_components.code, null, \"self.postMessage\"), \").\"), \"\\n\"), React.createElement(_components.p, null, \"크롬이 죽는 시점은 \", React.createElement(_components.code, null, \"fetch\"), \" 메서드가 실행되는 순간이다 (위에서는 3번 시점). 리퀘스트는 발송되지 않고 \", React.createElement(_components.code, null, \"fetch\"), \" 가 호출되는 그 순간 바로 죽어버린다.\"), React.createElement(_components.p, null, \"테스트를 위해 워커에서 다른 리퀘스트들도 요청해봤는데 다른 리퀘스트들은 정상적으로 동작했다. 오로지 \", React.createElement(_components.code, null, \"body\"), \" 에 파일이 실려있을 때만 크롬이 죽었다.\"), React.createElement(_components.p, null, \"왜 파일 업로드 요청에서만 죽는가? 라는 것은 알아내지 못했다. 혹시 우리가 Web Worker 혹은 \", React.createElement(_components.code, null, \"fetch\"), \" 메서드의 중요한 무언가를 놓친 게 아닐까 싶다가도, 크롬 업데이트 전에는 문제없었으며 현재도 파이어폭스 및 사파리에서는 멀쩡히 동작하기 때문에 그건 아닌 것 같았다.\"), React.createElement(_components.p, null, \"그리고 설령 우리가 놓친 게 뭔가 있다고 할지라도 꽤 오랜 시간을 검색에 투자했음에도 이렇다 할 글을 찾지 못한 걸로 봐서는 쉽게 찾아질 녀석은 아닌 게 분명했다.\"), React.createElement(_components.p, null, \"따라서 우리는 일단 근본적인 원인을 찾는 것은 멈추고 **'Web Worker 에서 \", React.createElement(_components.code, null, \"fetch\"), \" 메서드로 파일 업로드 시도'**를 원인으로 하여 해결책을 찾기로 했다.\"), React.createElement(_components.h2, {\n    id: \"3-수정\",\n    style: {\n      position: \"relative\"\n    }\n  }, React.createElement(_components.a, {\n    href: \"#3-%EC%88%98%EC%A0%95\",\n    \"aria-label\": \"3 수정 permalink\",\n    className: \"anchor before\"\n  }, React.createElement(_components.div, {\n    dangerouslySetInnerHTML: {\n      __html: \"<svg aria-hidden=\\\"true\\\" focusable=\\\"false\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg>\"\n    }\n  })), \"3. 수정\"), React.createElement(_components.p, null, \"원인을 찾았으니 해결 방법은 명확하다. \", React.createElement(_components.code, null, \"fetch\"), \" 메서드를 쓰지 않으면 된다. 대신 \", React.createElement(_components.code, null, \"XMLHttpRequest\"), \" 를 쓰자. \", React.createElement(_components.code, null, \"fetch\"), \" 메서드의 문제가 맞다면 이것만으로도 충분히 버그는 제거될 것이다.\"), React.createElement(_components.h3, {\n    id: \"31-fetch-를-사용한-기존-코드\",\n    style: {\n      position: \"relative\"\n    }\n  }, React.createElement(_components.a, {\n    href: \"#31-fetch-%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-%EA%B8%B0%EC%A1%B4-%EC%BD%94%EB%93%9C\",\n    \"aria-label\": \"31 fetch 를 사용한 기존 코드 permalink\",\n    className: \"anchor before\"\n  }, React.createElement(_components.div, {\n    dangerouslySetInnerHTML: {\n      __html: \"<svg aria-hidden=\\\"true\\\" focusable=\\\"false\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg>\"\n    }\n  })), \"3.1. \", React.createElement(_components.code, null, \"fetch\"), \" 를 사용한 기존 코드\"), React.createElement(_components.div, {\n    className: \"codeblock-container\"\n  }, React.createElement(_components.div, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"javascript\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// UI로부터 받아온 해시 형식의 데이터를 FormData 로 변환하는 메서드</span>\\n<span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">getFormData</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">body</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> formData <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">FormData</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">keys</span><span class=\\\"token punctuation\\\">(</span>body<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">key</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>body<span class=\\\"token punctuation\\\">[</span>key<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token keyword\\\">instanceof</span> <span class=\\\"token class-name\\\">FileList</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">for</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">let</span> i <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">;</span> i <span class=\\\"token operator\\\">&lt;</span> body<span class=\\\"token punctuation\\\">[</span>key<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>length<span class=\\\"token punctuation\\\">;</span> i<span class=\\\"token operator\\\">++</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        formData<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">append</span><span class=\\\"token punctuation\\\">(</span>key<span class=\\\"token punctuation\\\">,</span> body<span class=\\\"token punctuation\\\">[</span>key<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">[</span>i<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n      formData<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">append</span><span class=\\\"token punctuation\\\">(</span>key<span class=\\\"token punctuation\\\">,</span> body<span class=\\\"token punctuation\\\">[</span>key<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">return</span> formData<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token comment\\\">// 리퀘스트 발송 메서드</span>\\n<span class=\\\"token keyword\\\">async</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">uploadImages</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">method<span class=\\\"token punctuation\\\">,</span> url<span class=\\\"token punctuation\\\">,</span> data</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">fetch</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constant\\\">URL</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">method</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"POST\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">mode</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"cors\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">headers</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">Authorization</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"JWT TOKEN\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">body</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token function\\\">getFormData</span><span class=\\\"token punctuation\\\">(</span>data<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">uploadImages</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token comment\\\">/* ... */</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), React.createElement(_components.button, {\n    className: \"codeblock-copy-button\"\n  }, \"COPY\")), React.createElement(_components.h3, {\n    id: \"32-xmlhttprequest-를-활용해-수정한-코드\",\n    style: {\n      position: \"relative\"\n    }\n  }, React.createElement(_components.a, {\n    href: \"#32-xmlhttprequest-%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%B4-%EC%88%98%EC%A0%95%ED%95%9C-%EC%BD%94%EB%93%9C\",\n    \"aria-label\": \"32 xmlhttprequest 를 활용해 수정한 코드 permalink\",\n    className: \"anchor before\"\n  }, React.createElement(_components.div, {\n    dangerouslySetInnerHTML: {\n      __html: \"<svg aria-hidden=\\\"true\\\" focusable=\\\"false\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg>\"\n    }\n  })), \"3.2. \", React.createElement(_components.code, null, \"XMLHttpRequest\"), \" 를 활용해 수정한 코드\"), React.createElement(_components.div, {\n    className: \"codeblock-container\"\n  }, React.createElement(_components.div, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"javascript\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// `XMLHttpRequest`를 사용한 코드</span>\\n\\n<span class=\\\"token comment\\\">// async/await 문법을 사용하기 위해 Promise 활용</span>\\n<span class=\\\"token keyword\\\">async</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">uploadImagesUsingXhr</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">method<span class=\\\"token punctuation\\\">,</span> url<span class=\\\"token punctuation\\\">,</span> token<span class=\\\"token punctuation\\\">,</span> data</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">resolve<span class=\\\"token punctuation\\\">,</span> reject</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> xhr <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">XMLHttpRequest</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    xhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">open</span><span class=\\\"token punctuation\\\">(</span>method<span class=\\\"token punctuation\\\">,</span> url<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    xhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setRequestHeader</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Authorization\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"JWT TOKEN\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    xhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function-variable function\\\">onreadystatechange</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>readyState <span class=\\\"token operator\\\">===</span> <span class=\\\"token number\\\">4</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constant\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">parse</span><span class=\\\"token punctuation\\\">(</span>xhr<span class=\\\"token punctuation\\\">.</span>response<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n    xhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function-variable function\\\">onerror</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">onerror</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token function\\\">reject</span><span class=\\\"token punctuation\\\">(</span>e<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    xhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">send</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">getFormData</span><span class=\\\"token punctuation\\\">(</span>data<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">uploadImagesUsingXhr</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token comment\\\">/* ... */</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), React.createElement(_components.button, {\n    className: \"codeblock-copy-button\"\n  }, \"COPY\")), React.createElement(_components.h2, {\n    id: \"4-결과\",\n    style: {\n      position: \"relative\"\n    }\n  }, React.createElement(_components.a, {\n    href: \"#4-%EA%B2%B0%EA%B3%BC\",\n    \"aria-label\": \"4 결과 permalink\",\n    className: \"anchor before\"\n  }, React.createElement(_components.div, {\n    dangerouslySetInnerHTML: {\n      __html: \"<svg aria-hidden=\\\"true\\\" focusable=\\\"false\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg>\"\n    }\n  })), \"4. 결과\"), React.createElement(_components.p, null, \"다행히도 \", React.createElement(_components.code, null, \"XMLHttpRequest\"), \" 를 활용해 수정하자 크롬에서도 문제없이 동작하게 되었다. 일단은 한숨 돌릴 수 있게 되었다.\")), \"\\n\", React.createElement(_components.div, {\n    className: \"toc\"\n  }, React.createElement(_components.p, null, \"목차\"), React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, React.createElement(_components.a, {\n    href: \"#1-%EB%B0%9C%EB%8B%A8\"\n  }, \"1. 발단\")), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.a, {\n    href: \"#2-%ED%98%84%ED%99%A9-%EB%B0%8F-%EC%9B%90%EC%9D%B8\"\n  }, \"2. 현황 및 원인\")), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.a, {\n    href: \"#3-%EC%88%98%EC%A0%95\"\n  }, \"3. 수정\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, React.createElement(_components.a, {\n    href: \"#31-fetch-%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-%EA%B8%B0%EC%A1%B4-%EC%BD%94%EB%93%9C\"\n  }, \"3.1. \", React.createElement(_components.code, null, \"fetch\"), \" 를 사용한 기존 코드\")), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.a, {\n    href: \"#32-xmlhttprequest-%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%B4-%EC%88%98%EC%A0%95%ED%95%9C-%EC%BD%94%EB%93%9C\"\n  }, \"3.2. \", React.createElement(_components.code, null, \"XMLHttpRequest\"), \" 를 활용해 수정한 코드\")), \"\\n\"), \"\\n\"), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.a, {\n    href: \"#4-%EA%B2%B0%EA%B3%BC\"\n  }, \"4. 결과\")), \"\\n\")));\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? React.createElement(MDXLayout, props, React.createElement(_createMdxContent, props)) : _createMdxContent(props);\n}\nexport default MDXContent;\n","import GATSBY_COMPILED_MDX from \"/Users/kangseong/workspace/private/blog/posts/2021/210330-chrome-web-worker-issue/index.mdx\";\nimport _taggedTemplateLiteralLoose from \"@babel/runtime/helpers/esm/taggedTemplateLiteralLoose\";\nvar _templateObject, _templateObject2, _templateObject3;\nimport * as React from \"react\";\nimport {Link} from \"gatsby\";\nimport {getImage} from \"gatsby-plugin-image\";\nimport Layout from \"../../components/Layout\";\nimport Seo from \"../../components/Seo\";\nimport styled from \"../../themes\";\nimport MdxContent from \"../../components/MdxContent\";\nimport NearbySeriesPostLinks from \"../../components/NearbySeriesPostLinks\";\nimport Comments from \"../../components/Comments\";\nimport SameSeriesPosts from \"../../components/SameSeriesPosts\";\nimport highlightCurrentHeading from \"../../utils/highlightCurrentHeading\";\nimport ScrollToEndButton from \"../../components/ScrollToEndButton\";\nfunction PostDetailPage(_ref) {\n  let {data, children} = _ref;\n  const ref = React.useRef();\n  const {frontmatter, sameSeriesPosts} = data.mdx;\n  const {title, slug, date, series} = frontmatter;\n  React.useEffect(() => {\n    var _ref$current;\n    const headingElements = (_ref$current = ref.current) === null || _ref$current === void 0 ? void 0 : _ref$current.querySelectorAll(\".md h1, .md h2, .md h3, .md h4, .md h5, .md h6\");\n    const observer = new IntersectionObserver(() => highlightCurrentHeading(ref, headingElements), {\n      rootMargin: \"0px 0px -90% 0px\",\n      threshold: [0, 1.0]\n    });\n    headingElements === null || headingElements === void 0 ? void 0 : headingElements.forEach(element => observer.observe(element));\n    return () => observer.disconnect();\n  }, []);\n  return React.createElement(Layout, null, React.createElement(Header, null, React.createElement(\"h1\", null, React.createElement(Link, {\n    to: \"/posts/\" + slug\n  }, title)), React.createElement(WrittenDate, null, date)), React.createElement(SameSeriesPosts, {\n    name: series,\n    data: sameSeriesPosts,\n    current: slug\n  }), React.createElement(PostContent, {\n    ref: ref\n  }, children), React.createElement(NearbySeriesPostLinks, {\n    data: sameSeriesPosts,\n    current: slug\n  }), React.createElement(ScrollToEndButton, null), React.createElement(Comments, null));\n}\nconst Header = styled.div(_templateObject || (_templateObject = _taggedTemplateLiteralLoose([\"\\n  margin: 72px 0 84px;\\n  padding: 0 32px;\\n\\n  & > h1 {\\n    font-size: 2.5rem;\\n    word-break: keep-all;\\n    margin: 0;\\n\\n    > a {\\n      color: \", \";\\n    }\\n  }\\n\"])), p => p.theme.colors.onBackground);\nconst WrittenDate = styled.div(_templateObject2 || (_templateObject2 = _taggedTemplateLiteralLoose([\"\\n  margin-left: 2px;\\n\"])));\nconst PostContent = styled(MdxContent)(_templateObject3 || (_templateObject3 = _taggedTemplateLiteralLoose([\"\\n  margin-bottom: 120px;\\n\"])));\nconst query = \"2677585968\";\nexport const Head = _ref2 => {\n  var _image$images, _image$images$fallbac;\n  let {data} = _ref2;\n  const {frontmatter: {title, slug, tags, heroImage, previewContent}, excerpt} = data.mdx;\n  const image = heroImage ? getImage(heroImage) : null;\n  return React.createElement(Seo, {\n    title: title,\n    description: previewContent !== null && previewContent !== void 0 ? previewContent : excerpt,\n    path: \"posts/\" + slug,\n    thumbnail: image === null || image === void 0 ? void 0 : (_image$images = image.images) === null || _image$images === void 0 ? void 0 : (_image$images$fallbac = _image$images.fallback) === null || _image$images$fallbac === void 0 ? void 0 : _image$images$fallbac.src,\n    keywords: tags,\n    ogType: \"article\"\n  });\n};\nPostDetailPage\nexport default function GatsbyMDXWrapper(props) {\n  return React.createElement(PostDetailPage, props, React.createElement(GATSBY_COMPILED_MDX, props));\n}\n"],"names":["_createMdxContent","props","_components","Object","assign","div","h2","a","p","code","ol","li","ul","h3","button","_provideComponents","components","React","className","id","style","position","href","dangerouslySetInnerHTML","__html","_templateObject","_templateObject2","_templateObject3","wrapper","MDXLayout","PostDetailPage","_ref","data","children","ref","frontmatter","sameSeriesPosts","mdx","title","slug","date","series","_ref$current","headingElements","current","querySelectorAll","observer","IntersectionObserver","highlightCurrentHeading","rootMargin","threshold","forEach","element","observe","disconnect","Layout","Header","Link","to","WrittenDate","SameSeriesPosts","name","PostContent","NearbySeriesPostLinks","ScrollToEndButton","Comments","styled","_taggedTemplateLiteralLoose","theme","colors","onBackground","MdxContent","Head","_ref2","_image$images","_image$images$fallbac","tags","heroImage","previewContent","excerpt","image","getImage","Seo","description","path","thumbnail","images","fallback","src","keywords","ogType","GatsbyMDXWrapper","GATSBY_COMPILED_MDX"],"sourceRoot":""}